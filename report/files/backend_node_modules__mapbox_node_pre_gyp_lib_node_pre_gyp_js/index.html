<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - backend\node_modules\@mapbox\node-pre-gyp\lib\node-pre-gyp.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>backend\node_modules\@mapbox\node-pre-gyp\lib\node-pre-gyp.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">65.94</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">309</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">32.62</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.12</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

/**
 * Module exports.
 */

module.exports = exports;

/**
 * Module dependencies.
 */

// load mocking control function for accessing s3 via https. the function is a noop always returning
// false if not mocking.
exports.mockS3Http = require(&#039;./util/s3_setup&#039;).get_mockS3Http();
exports.mockS3Http(&#039;on&#039;);
const mocking = exports.mockS3Http(&#039;get&#039;);


const fs = require(&#039;fs&#039;);
const path = require(&#039;path&#039;);
const nopt = require(&#039;nopt&#039;);
const log = require(&#039;npmlog&#039;);
log.disableProgress();
const napi = require(&#039;./util/napi.js&#039;);

const EE = require(&#039;events&#039;).EventEmitter;
const inherits = require(&#039;util&#039;).inherits;
const cli_commands = [
  &#039;clean&#039;,
  &#039;install&#039;,
  &#039;reinstall&#039;,
  &#039;build&#039;,
  &#039;rebuild&#039;,
  &#039;package&#039;,
  &#039;testpackage&#039;,
  &#039;publish&#039;,
  &#039;unpublish&#039;,
  &#039;info&#039;,
  &#039;testbinary&#039;,
  &#039;reveal&#039;,
  &#039;configure&#039;
];
const aliases = {};

// differentiate node-pre-gyp&#039;s logs from npm&#039;s
log.heading = &#039;node-pre-gyp&#039;;

if (mocking) {
  log.warn(`mocking s3 to ${process.env.node_pre_gyp_mock_s3}`);
}

// this is a getter to avoid circular reference warnings with node v14.
Object.defineProperty(exports, &#039;find&#039;, {
  get: function() {
    return require(&#039;./pre-binding&#039;).find;
  },
  enumerable: true
});

// in the following, &quot;my_module&quot; is using node-pre-gyp to
// prebuild and install pre-built binaries. &quot;main_module&quot;
// is using &quot;my_module&quot;.
//
// &quot;bin/node-pre-gyp&quot; invokes Run() without a path. the
// expectation is that the working directory is the package
// root &quot;my_module&quot;. this is true because in all cases npm is
// executing a script in the context of &quot;my_module&quot;.
//
// &quot;pre-binding.find()&quot; is executed by &quot;my_module&quot; but in the
// context of &quot;main_module&quot;. this is because &quot;main_module&quot; is
// executing and requires &quot;my_module&quot; which is then executing
// &quot;pre-binding.find()&quot; via &quot;node-pre-gyp.find()&quot;, so the working
// directory is that of &quot;main_module&quot;.
//
// that&#039;s why &quot;find()&quot; must pass the path to package.json.
//
function Run({ package_json_path = &#039;./package.json&#039;, argv }) {
  this.package_json_path = package_json_path;
  this.commands = {};

  const self = this;
  cli_commands.forEach((command) =&gt; {
    self.commands[command] = function(argvx, callback) {
      log.verbose(&#039;command&#039;, command, argvx);
      return require(&#039;./&#039; + command)(self, argvx, callback);
    };
  });

  this.parseArgv(argv);

  // this is set to true after the binary.host property was set to
  // either staging_host or production_host.
  this.binaryHostSet = false;
}
inherits(Run, EE);
exports.Run = Run;
const proto = Run.prototype;

/**
 * Export the contents of the package.json.
 */

proto.package = require(&#039;../package.json&#039;);

/**
 * nopt configuration definitions
 */

proto.configDefs = {
  help: Boolean,     // everywhere
  arch: String,      // &#039;configure&#039;
  debug: Boolean,    // &#039;build&#039;
  directory: String, // bin
  proxy: String,     // &#039;install&#039;
  loglevel: String  // everywhere
};

/**
 * nopt shorthands
 */

proto.shorthands = {
  release: &#039;--no-debug&#039;,
  C: &#039;--directory&#039;,
  debug: &#039;--debug&#039;,
  j: &#039;--jobs&#039;,
  silent: &#039;--loglevel=silent&#039;,
  silly: &#039;--loglevel=silly&#039;,
  verbose: &#039;--loglevel=verbose&#039;
};

/**
 * expose the command aliases for the bin file to use.
 */

proto.aliases = aliases;

/**
 * Parses the given argv array and sets the &#039;opts&#039;, &#039;argv&#039;,
 * &#039;command&#039;, and &#039;package_json&#039; properties.
 */

proto.parseArgv = function parseOpts(argv) {
  this.opts = nopt(this.configDefs, this.shorthands, argv);
  this.argv = this.opts.argv.remain.slice();
  const commands = this.todo = [];

  // create a copy of the argv array with aliases mapped
  argv = this.argv.map((arg) =&gt; {
    // is this an alias?
    if (arg in this.aliases) {
      arg = this.aliases[arg];
    }
    return arg;
  });

  // process the mapped args into &quot;command&quot; objects (&quot;name&quot; and &quot;args&quot; props)
  argv.slice().forEach((arg) =&gt; {
    if (arg in this.commands) {
      const args = argv.splice(0, argv.indexOf(arg));
      argv.shift();
      if (commands.length &gt; 0) {
        commands[commands.length - 1].args = args;
      }
      commands.push({ name: arg, args: [] });
    }
  });
  if (commands.length &gt; 0) {
    commands[commands.length - 1].args = argv.splice(0);
  }


  // if a directory was specified package.json is assumed to be relative
  // to it.
  let package_json_path = this.package_json_path;
  if (this.opts.directory) {
    package_json_path = path.join(this.opts.directory, package_json_path);
  }

  this.package_json = JSON.parse(fs.readFileSync(package_json_path));

  // expand commands entries for multiple napi builds
  this.todo = napi.expand_commands(this.package_json, this.opts, commands);

  // support for inheriting config env variables from npm
  const npm_config_prefix = &#039;npm_config_&#039;;
  Object.keys(process.env).forEach((name) =&gt; {
    if (name.indexOf(npm_config_prefix) !== 0) return;
    const val = process.env[name];
    if (name === npm_config_prefix + &#039;loglevel&#039;) {
      log.level = val;
    } else {
      // add the user-defined options to the config
      name = name.substring(npm_config_prefix.length);
      // avoid npm argv clobber already present args
      // which avoids problem of &#039;npm test&#039; calling
      // script that runs unique npm install commands
      if (name === &#039;argv&#039;) {
        if (this.opts.argv &amp;&amp;
             this.opts.argv.remain &amp;&amp;
             this.opts.argv.remain.length) {
          // do nothing
        } else {
          this.opts[name] = val;
        }
      } else {
        this.opts[name] = val;
      }
    }
  });

  if (this.opts.loglevel) {
    log.level = this.opts.loglevel;
  }
  log.resume();
};

/**
 * allow the binary.host property to be set at execution time.
 *
 * for this to take effect requires all the following to be true.
 * - binary is a property in package.json
 * - binary.host is falsey
 * - binary.staging_host is not empty
 * - binary.production_host is not empty
 *
 * if any of the previous checks fail then the function returns an empty string
 * and makes no changes to package.json&#039;s binary property.
 *
 *
 * if command is &quot;publish&quot; then the default is set to &quot;binary.staging_host&quot;
 * if command is not &quot;publish&quot; the the default is set to &quot;binary.production_host&quot;
 *
 * if the command-line option &#039;--s3_host&#039; is set to &quot;staging&quot; or &quot;production&quot; then
 * &quot;binary.host&quot; is set to the specified &quot;staging_host&quot; or &quot;production_host&quot;. if
 * &#039;--s3_host&#039; is any other value an exception is thrown.
 *
 * if &#039;--s3_host&#039; is not present then &quot;binary.host&quot; is set to the default as above.
 *
 * this strategy was chosen so that any command other than &quot;publish&quot; or &quot;unpublish&quot; uses &quot;production&quot;
 * as the default without requiring any command-line options but that &quot;publish&quot; and &quot;unpublish&quot; require
 * &#039;--s3_host production_host&#039; to be specified in order to *really* publish (or unpublish). publishing
 * to staging can be done freely without worrying about disturbing any production releases.
 */
proto.setBinaryHostProperty = function(command) {
  if (this.binaryHostSet) {
    return this.package_json.binary.host;
  }
  const p = this.package_json;
  // don&#039;t set anything if host is present. it must be left blank to trigger this.
  if (!p || !p.binary || p.binary.host) {
    return &#039;&#039;;
  }
  // and both staging and production must be present. errors will be reported later.
  if (!p.binary.staging_host || !p.binary.production_host) {
    return &#039;&#039;;
  }
  let target = &#039;production_host&#039;;
  if (command === &#039;publish&#039; || command === &#039;unpublish&#039;) {
    target = &#039;staging_host&#039;;
  }
  // the environment variable has priority over the default or the command line. if
  // either the env var or the command line option are invalid throw an error.
  const npg_s3_host = process.env.node_pre_gyp_s3_host;
  if (npg_s3_host === &#039;staging&#039; || npg_s3_host === &#039;production&#039;) {
    target = `${npg_s3_host}_host`;
  } else if (this.opts[&#039;s3_host&#039;] === &#039;staging&#039; || this.opts[&#039;s3_host&#039;] === &#039;production&#039;) {
    target = `${this.opts[&#039;s3_host&#039;]}_host`;
  } else if (this.opts[&#039;s3_host&#039;] || npg_s3_host) {
    throw new Error(`invalid s3_host ${this.opts[&#039;s3_host&#039;] || npg_s3_host}`);
  }

  p.binary.host = p.binary[target];
  this.binaryHostSet = true;

  return p.binary.host;
};

/**
 * Returns the usage instructions for node-pre-gyp.
 */

proto.usage = function usage() {
  const str = [
    &#039;&#039;,
    &#039;  Usage: node-pre-gyp &lt;command&gt; [options]&#039;,
    &#039;&#039;,
    &#039;  where &lt;command&gt; is one of:&#039;,
    cli_commands.map((c) =&gt; {
      return &#039;    - &#039; + c + &#039; - &#039; + require(&#039;./&#039; + c).usage;
    }).join(&#039;\n&#039;),
    &#039;&#039;,
    &#039;node-pre-gyp@&#039; + this.version + &#039;  &#039; + path.resolve(__dirname, &#039;..&#039;),
    &#039;node@&#039; + process.versions.node
  ].join(&#039;\n&#039;);
  return str;
};

/**
 * Version number getter.
 */

Object.defineProperty(proto, &#039;version&#039;, {
  get: function() {
    return this.package.version;
  },
  enumerable: true
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
