<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - backend\node_modules\@mapbox\node-pre-gyp\lib\util\napi.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>backend\node_modules\@mapbox\node-pre-gyp\lib\util\napi.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">70.44</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">205</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">63.72</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.22</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

const fs = require(&#039;fs&#039;);

module.exports = exports;

const versionArray = process.version
  .substr(1)
  .replace(/-.*$/, &#039;&#039;)
  .split(&#039;.&#039;)
  .map((item) =&gt; {
    return +item;
  });

const napi_multiple_commands = [
  &#039;build&#039;,
  &#039;clean&#039;,
  &#039;configure&#039;,
  &#039;package&#039;,
  &#039;publish&#039;,
  &#039;reveal&#039;,
  &#039;testbinary&#039;,
  &#039;testpackage&#039;,
  &#039;unpublish&#039;
];

const napi_build_version_tag = &#039;napi_build_version=&#039;;

module.exports.get_napi_version = function() {
  // returns the non-zero numeric napi version or undefined if napi is not supported.
  // correctly supporting target requires an updated cross-walk
  let version = process.versions.napi; // can be undefined
  if (!version) { // this code should never need to be updated
    if (versionArray[0] === 9 &amp;&amp; versionArray[1] &gt;= 3) version = 2; // 9.3.0+
    else if (versionArray[0] === 8) version = 1; // 8.0.0+
  }
  return version;
};

module.exports.get_napi_version_as_string = function(target) {
  // returns the napi version as a string or an empty string if napi is not supported.
  const version = module.exports.get_napi_version(target);
  return version ? &#039;&#039; + version : &#039;&#039;;
};

module.exports.validate_package_json = function(package_json, opts) { // throws Error

  const binary = package_json.binary;
  const module_path_ok = pathOK(binary.module_path);
  const remote_path_ok = pathOK(binary.remote_path);
  const package_name_ok = pathOK(binary.package_name);
  const napi_build_versions = module.exports.get_napi_build_versions(package_json, opts, true);
  const napi_build_versions_raw = module.exports.get_napi_build_versions_raw(package_json);

  if (napi_build_versions) {
    napi_build_versions.forEach((napi_build_version)=&gt; {
      if (!(parseInt(napi_build_version, 10) === napi_build_version &amp;&amp; napi_build_version &gt; 0)) {
        throw new Error(&#039;All values specified in napi_versions must be positive integers.&#039;);
      }
    });
  }

  if (napi_build_versions &amp;&amp; (!module_path_ok || (!remote_path_ok &amp;&amp; !package_name_ok))) {
    throw new Error(&#039;When napi_versions is specified; module_path and either remote_path or &#039; +
			&quot;package_name must contain the substitution string &#039;{napi_build_version}`.&quot;);
  }

  if ((module_path_ok || remote_path_ok || package_name_ok) &amp;&amp; !napi_build_versions_raw) {
    throw new Error(&quot;When the substitution string &#039;{napi_build_version}` is specified in &quot; +
			&#039;module_path, remote_path, or package_name; napi_versions must also be specified.&#039;);
  }

  if (napi_build_versions &amp;&amp; !module.exports.get_best_napi_build_version(package_json, opts) &amp;&amp;
	module.exports.build_napi_only(package_json)) {
    throw new Error(
      &#039;The Node-API version of this Node instance is &#039; + module.exports.get_napi_version(opts ? opts.target : undefined) + &#039;. &#039; +
			&#039;This module supports Node-API version(s) &#039; + module.exports.get_napi_build_versions_raw(package_json) + &#039;. &#039; +
			&#039;This Node instance cannot run this module.&#039;);
  }

  if (napi_build_versions_raw &amp;&amp; !napi_build_versions &amp;&amp; module.exports.build_napi_only(package_json)) {
    throw new Error(
      &#039;The Node-API version of this Node instance is &#039; + module.exports.get_napi_version(opts ? opts.target : undefined) + &#039;. &#039; +
			&#039;This module supports Node-API version(s) &#039; + module.exports.get_napi_build_versions_raw(package_json) + &#039;. &#039; +
			&#039;This Node instance cannot run this module.&#039;);
  }

};

function pathOK(path) {
  return path &amp;&amp; (path.indexOf(&#039;{napi_build_version}&#039;) !== -1 || path.indexOf(&#039;{node_napi_label}&#039;) !== -1);
}

module.exports.expand_commands = function(package_json, opts, commands) {
  const expanded_commands = [];
  const napi_build_versions = module.exports.get_napi_build_versions(package_json, opts);
  commands.forEach((command)=&gt; {
    if (napi_build_versions &amp;&amp; command.name === &#039;install&#039;) {
      const napi_build_version = module.exports.get_best_napi_build_version(package_json, opts);
      const args = napi_build_version ? [napi_build_version_tag + napi_build_version] : [];
      expanded_commands.push({ name: command.name, args: args });
    } else if (napi_build_versions &amp;&amp; napi_multiple_commands.indexOf(command.name) !== -1) {
      napi_build_versions.forEach((napi_build_version)=&gt; {
        const args = command.args.slice();
        args.push(napi_build_version_tag + napi_build_version);
        expanded_commands.push({ name: command.name, args: args });
      });
    } else {
      expanded_commands.push(command);
    }
  });
  return expanded_commands;
};

module.exports.get_napi_build_versions = function(package_json, opts, warnings) { // opts may be undefined
  const log = require(&#039;npmlog&#039;);
  let napi_build_versions = [];
  const supported_napi_version = module.exports.get_napi_version(opts ? opts.target : undefined);
  // remove duplicates, verify each napi version can actaully be built
  if (package_json.binary &amp;&amp; package_json.binary.napi_versions) {
    package_json.binary.napi_versions.forEach((napi_version) =&gt; {
      const duplicated = napi_build_versions.indexOf(napi_version) !== -1;
      if (!duplicated &amp;&amp; supported_napi_version &amp;&amp; napi_version &lt;= supported_napi_version) {
        napi_build_versions.push(napi_version);
      } else if (warnings &amp;&amp; !duplicated &amp;&amp; supported_napi_version) {
        log.info(&#039;This Node instance does not support builds for Node-API version&#039;, napi_version);
      }
    });
  }
  if (opts &amp;&amp; opts[&#039;build-latest-napi-version-only&#039;]) {
    let latest_version = 0;
    napi_build_versions.forEach((napi_version) =&gt; {
      if (napi_version &gt; latest_version) latest_version = napi_version;
    });
    napi_build_versions = latest_version ? [latest_version] : [];
  }
  return napi_build_versions.length ? napi_build_versions : undefined;
};

module.exports.get_napi_build_versions_raw = function(package_json) {
  const napi_build_versions = [];
  // remove duplicates
  if (package_json.binary &amp;&amp; package_json.binary.napi_versions) {
    package_json.binary.napi_versions.forEach((napi_version) =&gt; {
      if (napi_build_versions.indexOf(napi_version) === -1) {
        napi_build_versions.push(napi_version);
      }
    });
  }
  return napi_build_versions.length ? napi_build_versions : undefined;
};

module.exports.get_command_arg = function(napi_build_version) {
  return napi_build_version_tag + napi_build_version;
};

module.exports.get_napi_build_version_from_command_args = function(command_args) {
  for (let i = 0; i &lt; command_args.length; i++) {
    const arg = command_args[i];
    if (arg.indexOf(napi_build_version_tag) === 0) {
      return parseInt(arg.substr(napi_build_version_tag.length), 10);
    }
  }
  return undefined;
};

module.exports.swap_build_dir_out = function(napi_build_version) {
  if (napi_build_version) {
    const rm = require(&#039;rimraf&#039;);
    rm.sync(module.exports.get_build_dir(napi_build_version));
    fs.renameSync(&#039;build&#039;, module.exports.get_build_dir(napi_build_version));
  }
};

module.exports.swap_build_dir_in = function(napi_build_version) {
  if (napi_build_version) {
    const rm = require(&#039;rimraf&#039;);
    rm.sync(&#039;build&#039;);
    fs.renameSync(module.exports.get_build_dir(napi_build_version), &#039;build&#039;);
  }
};

module.exports.get_build_dir = function(napi_build_version) {
  return &#039;build-tmp-napi-v&#039; + napi_build_version;
};

module.exports.get_best_napi_build_version = function(package_json, opts) {
  let best_napi_build_version = 0;
  const napi_build_versions = module.exports.get_napi_build_versions(package_json, opts);
  if (napi_build_versions) {
    const our_napi_version = module.exports.get_napi_version(opts ? opts.target : undefined);
    napi_build_versions.forEach((napi_build_version)=&gt; {
      if (napi_build_version &gt; best_napi_build_version &amp;&amp;
				napi_build_version &lt;= our_napi_version) {
        best_napi_build_version = napi_build_version;
      }
    });
  }
  return best_napi_build_version === 0 ? undefined : best_napi_build_version;
};

module.exports.build_napi_only = function(package_json) {
  return package_json.binary &amp;&amp; package_json.binary.package_name &amp;&amp;
	package_json.binary.package_name.indexOf(&#039;{node_napi_label}&#039;) === -1;
};</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ cyclomatic }} <br>
    Length : {{ halstead.length }} <br>
    Difficulty : {{ halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
